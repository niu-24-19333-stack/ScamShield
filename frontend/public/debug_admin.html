<!DOCTYPE html>
<html>
<head>
    <title>Admin Login Debug</title>
</head>
<body>
    <h1>Admin Login Debug Test</h1>
    <button onclick="testAdminLogin()">Test Admin Login Flow</button>
    <button onclick="checkStoredData()">Check Stored Data</button>
    <button onclick="clearStorage()">Clear Storage</button>
    <div id="output" style="margin-top: 20px; font-family: monospace; white-space: pre-wrap;"></div>

    <script src="./js/config.js"></script>
    <script src="./js/api.js"></script>
    
    <script>
        function log(message) {
            const output = document.getElementById('output');
            output.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
        }

        async function testAdminLogin() {
            document.getElementById('output').textContent = '';
            log('ğŸ§ª Starting admin login test...');
            
            try {
                // Test login
                log('ğŸ“¡ Calling login API...');
                const response = await api.login('raghavshivam4321@gmail.com', 'Thakur.4321');
                log('âœ… Login API successful');
                log('ğŸ‘¤ User: ' + response.user?.email);
                log('ğŸ‘‘ Role: ' + response.user?.role);
                
                // Check what's stored
                log('\nğŸ“¦ Checking localStorage...');
                const token = localStorage.getItem('scamshield_access_token');
                const userData = localStorage.getItem('scamshield_user');
                
                log('ğŸ”‘ Token stored: ' + (token ? 'YES (length: ' + token.length + ')' : 'NO'));
                log('ğŸ‘¤ User data stored: ' + (userData ? 'YES' : 'NO'));
                
                if (userData) {
                    try {
                        const parsedUser = JSON.parse(userData);
                        log('ğŸ“‹ Stored user email: ' + parsedUser.email);
                        log('ğŸ‘‘ Stored user role: ' + parsedUser.role);
                        log('ğŸ”„ Role type: ' + typeof parsedUser.role);
                        log('ğŸ”„ Role toLowerCase: ' + parsedUser.role?.toLowerCase());
                    } catch (e) {
                        log('âŒ Error parsing user data: ' + e.message);
                    }
                }
                
                // Test redirect logic
                log('\nğŸ¯ Testing redirect logic...');
                const user = response.user || api.getUser();
                if (!user) {
                    log('âŒ No user data for redirect');
                    return;
                }
                
                const isAdmin = user && (user.role === 'admin' || user.role === 'ADMIN');
                log('ğŸ” Admin check result: ' + isAdmin);
                log('ğŸ” User role value: "' + user.role + '"');
                log('ğŸ” User role type: ' + typeof user.role);
                
                if (isAdmin) {
                    log('âœ… Would redirect to admin panel');
                } else {
                    log('âŒ Would redirect to regular dashboard');
                }
                
            } catch (error) {
                log('âŒ Login failed: ' + error.message);
            }
        }

        function checkStoredData() {
            document.getElementById('output').textContent = '';
            log('ğŸ“¦ Current localStorage data:');
            
            const token = localStorage.getItem('scamshield_access_token');
            const user = localStorage.getItem('scamshield_user');
            
            log('ğŸ”‘ Token: ' + (token ? 'EXISTS (length: ' + token.length + ')' : 'NOT FOUND'));
            log('ğŸ‘¤ User: ' + (user ? 'EXISTS' : 'NOT FOUND'));
            
            if (user) {
                log('ğŸ‘¤ Raw user data: ' + user);
                try {
                    const parsed = JSON.parse(user);
                    log('ğŸ“§ Email: ' + parsed.email);
                    log('ğŸ‘‘ Role: "' + parsed.role + '"');
                    log('ğŸ” Role type: ' + typeof parsed.role);
                } catch (e) {
                    log('âŒ Invalid JSON: ' + e.message);
                }
            }
        }

        function clearStorage() {
            localStorage.removeItem('scamshield_access_token');
            localStorage.removeItem('scamshield_user');
            log('ğŸ—‘ï¸ Storage cleared');
        }
    </script>
</body>
</html>